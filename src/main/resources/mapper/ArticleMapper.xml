<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.library.mapper.ArticleMapper">

	<!-- 게시글 목록 전체 조회 - 관리자 -->
	<select id="getAllArticles" resultType="com.library.model.Article">
		SELECT * FROM ARTICLES
	</select>
	
	<!-- 게시글 목록 조회 (category 기반) -->
	<select id="getAllArticlesByCategory" resultType="com.library.model.Article" parameterType="String">
		SELECT * FROM ARTICLES WHERE CATEGORY = #{category}
	</select>
	
	<!-- 게시글 상세 조회 (articleById 기반) -->
	<select id="getArticleById" resultType="com.library.model.Article" parameterType="int">
		SELECT * FROM ARTICLES WHERE ARTICLES_ID = #{articlesId}
	</select>
	
	<!-- 게시글 정보 수정 -->
    <!-- 1) 정보 수정 : title, content -->
    <update id="updateArticleInfo" parameterType="com.library.model.Article">
        UPDATE ARTICLES 
        SET	TITLE = #{title}, 
        	CONTENT = #{content}
	    WHERE ARTICLES_ID = #{articlesId}
    </update>
    
    <!-- 2) 비공개글 전환 : status -->
    <update id="updateArticleDisable" parameterType="int">
        UPDATE ARTICLES 
        SET	STATUS = 2
	    WHERE ARTICLES_ID = #{articlesId}
    </update>
    
    <!-- 3) 공개글 전환 : status -->
    <update id="updateArticleEnable" parameterType="int">
        UPDATE ARTICLES 
        SET	STATUS = 0
	    WHERE ARTICLES_ID = #{articlesId}
    </update>
    
    <!-- 4) 비밀글 전환 : status -->
    <update id="updateArticleSecret" parameterType="int">
        UPDATE ARTICLES 
        SET	STATUS = 1
	    WHERE ARTICLES_ID = #{articlesId}
    </update>
    
    <!-- 5) view count 증가 -->
    <update id="updateArticleViewCountUp" parameterType="int">
        UPDATE ARTICLES 
        SET	VIEW_COUNT = VIEW_COUNT + 1
	    WHERE ARTICLES_ID = #{articlesId}
    </update>
    
    <!-- 6) reply count 증가 -->
    <update id="updateArticleReplyCountUp" parameterType="int">
        UPDATE ARTICLES 
        SET	REPLY_COUNT = REPLY_COUNT + 1
	    WHERE ARTICLES_ID = #{articlesId}
    </update>
    
    <!-- 7) reply count 감소 -->
    <update id="updateArticleReplyCountDown" parameterType="int">
        UPDATE ARTICLES 
        SET	REPLY_COUNT = REPLY_COUNT - 1
	    WHERE ARTICLES_ID = #{articlesId} AND REPLY_COUNT > 0
    </update>
    
    <!-- 게시글 등록 -->
    <insert id="insertArticle" parameterType="com.library.model.Article">
	    <selectKey keyProperty="articlesId" resultType="java.lang.Integer" order="BEFORE">
	        SELECT SQ_ARTICLES.NEXTVAL FROM DUAL
	    </selectKey>
        INSERT INTO ARTICLES (
		    ARTICLES_ID, AUTHOR_ID, CATEGORY, 
		    TITLE, CONTENT, CREATE_DATE, UPDATE_DATE, 
		    REPLY_COUNT, VIEW_COUNT, STATUS
		) VALUES (
		    #{articlesId}, #{authorId}, #{category}, 
		    #{title}, #{content}, #{createDate}, #{updateDate}, 
		    #{replyCount}, #{viewCount}, #{status}
		);
    </insert>

    <!-- 게시글 삭제 -->
    <delete id="deleteArticle" parameterType="int">
        DELETE FROM ARTICLES WHERE ARTICLES_ID = #{articlesId}
    </delete>
	
</mapper>